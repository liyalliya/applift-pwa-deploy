(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{1252:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/workout-monitor",function(){return r(5267)}])},2492:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var s=r(5893),a=r(645),i=r.n(a),l=r(7294);function n(e){var t,r;let{connected:a,device:n,onScan:o,onConnect:c,onDisconnect:d,scanning:u,devicesFound:h=[],availability:x,collapse:m=0}=e,[f,p]=(0,l.useState)(!1),g=(0,l.useRef)(null);(0,l.useEffect)(()=>{function e(e){g.current&&!g.current.contains(e.target)&&p(!1)}return f&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]),(0,l.useEffect)(()=>{function e(e){"Escape"===e.key&&p(!1)}return f&&document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]);let b=async()=>{o&&await o()},w=async e=>{c&&(await c(e),p(!1))};return(0,s.jsxs)(s.Fragment,{children:[f&&(0,s.jsx)("div",{style:{animation:"fadeIn 0.3s ease-out"},onClick:()=>p(!1),className:"jsx-82ef8ed3900938e3 fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] transition-opacity duration-300"}),(0,s.jsx)("div",{ref:g,style:{width:m>0?"56px":"100%",maxWidth:m>0?"56px":"28rem",paddingLeft:m>0||f?"auto":"20px",paddingRight:m>0||f?"auto":"20px",paddingLeft:f?"24px":m>0?"12px":"20px",paddingRight:f?"24px":m>0?"12px":"20px",maxHeight:f?"520px":"88px",background:a?"radial-gradient(circle, rgb(141, 184, 11) 0%, rgb(56, 139, 42) 50%, rgb(59, 105, 2) 100%)":"linear-gradient(90deg, #2A2A2A 0%, #3A3A3A 100%)",borderColor:a?"rgba(5, 150, 105, 0.55)":"rgba(107, 114, 128, 0.45)",boxShadow:a?"0 18px 50px rgba(16, 185, 129, 0.25)":"0 14px 40px rgba(0, 0, 0, 0.25)",transition:f||m>0?"max-height 600ms ease, padding 400ms ease, border-radius 400ms ease, background 800ms ease-in-out, border-color 800ms ease-in-out, box-shadow 800ms ease-in-out, width 600ms ease, max-width 600ms ease":"max-height 600ms ease, padding 400ms ease, border-radius 400ms ease, background 800ms ease-in-out, border-color 800ms ease-in-out, box-shadow 800ms ease-in-out",animation:a?"shimmer 12s linear infinite":"none",backgroundSize:a?"150% 100%":"100% 100%",backgroundPosition:"left center"},className:"jsx-82ef8ed3900938e3 "+"relative overflow-hidden border shadow-lg transition-all duration-600 ease-[cubic-bezier(0.22,1,0.36,1)] ".concat(f?"z-[10000] rounded-[24px] px-6 py-6 w-full max-w-sm":"z-50 rounded-[32px] py-3"),children:!f&&m<1?(0,s.jsxs)("button",{onClick:()=>p(!0),style:{opacity:0===m?1:0},className:"jsx-82ef8ed3900938e3 flex flex-1 items-center gap-3 w-full cursor-pointer active:scale-98 transition-transform duration-300 ease-[cubic-bezier(0.22,1,0.36,1)]",children:[(0,s.jsx)("div",{className:"jsx-82ef8ed3900938e3 "+"flex h-10 w-10 items-center justify-center rounded-full transition-all duration-300 flex-shrink-0 ".concat(a?"bg-white/20":"bg-gray-600/40"),children:(0,s.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,className:"jsx-82ef8ed3900938e3",children:(0,s.jsx)("path",{fill:"#ffffff",d:"m9.41 0l6 6l-4 4l4 4l-6 6H9v-7.59l-3.3 3.3l-1.4-1.42L8.58 10l-4.3-4.3L5.7 4.3L9 7.58V0h.41zM11 4.41V7.6L12.59 6L11 4.41zM12.59 14L11 12.41v3.18L12.59 14z",className:"jsx-82ef8ed3900938e3"})})}),(0,s.jsxs)("div",{style:{opacity:Math.max(0,1-1.5*m)},className:"jsx-82ef8ed3900938e3 flex flex-col leading-tight items-start",children:[(0,s.jsx)("span",{className:"jsx-82ef8ed3900938e3 text-xs font-medium tracking-tight text-white",children:"Your Device is"}),(0,s.jsx)("span",{className:"jsx-82ef8ed3900938e3 text-sm text-white/80 font-semibold tracking-tight",children:a?"Connected":"Not Connected"})]})]}):m>=1?(0,s.jsx)("button",{onClick:()=>p(!0),style:{background:"transparent",margin:"0 auto"},"aria-label":"Bluetooth",className:"jsx-82ef8ed3900938e3 flex items-center justify-center w-10 h-10 rounded-full transition-all duration-300 cursor-pointer",children:(0,s.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,className:"jsx-82ef8ed3900938e3",children:(0,s.jsx)("path",{fill:"#ffffff",d:"m9.41 0l6 6l-4 4l4 4l-6 6H9v-7.59l-3.3 3.3l-1.4-1.42L8.58 10l-4.3-4.3L5.7 4.3L9 7.58V0h.41zM11 4.41V7.6L12.59 6L11 4.41zM12.59 14L11 12.41v3.18L12.59 14z",className:"jsx-82ef8ed3900938e3"})})}):(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 space-y-4",children:[(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 flex items-center gap-3",children:[(0,s.jsx)("div",{className:"jsx-82ef8ed3900938e3 "+"flex h-10 w-10 items-center justify-center rounded-full ".concat(a?"bg-white/20":"bg-gray-600/40"),children:(0,s.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,className:"jsx-82ef8ed3900938e3",children:(0,s.jsx)("path",{fill:"#ffffff",d:"m9.41 0l6 6l-4 4l4 4l-6 6H9v-7.59l-3.3 3.3l-1.4-1.42L8.58 10l-4.3-4.3L5.7 4.3L9 7.58V0h.41zM11 4.41V7.6L12.59 6L11 4.41zM12.59 14L11 12.41v3.18L12.59 14z",className:"jsx-82ef8ed3900938e3"})})}),(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 flex flex-col leading-tight",children:[(0,s.jsx)("span",{className:"jsx-82ef8ed3900938e3 text-sm font-semibold text-white",children:"Bluetooth Pairing"}),(0,s.jsx)("span",{className:"jsx-82ef8ed3900938e3 text-xs text-white/70",children:a?"Connected":"Not Connected"})]})]}),(0,s.jsx)("button",{onClick:()=>p(!1),"aria-label":"Close",className:"jsx-82ef8ed3900938e3 flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-white/80 hover:bg-white/20 transition-colors",children:"✕"})]}),a&&n?(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 space-y-3",children:[(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 rounded-2xl bg-white/10 border border-white/20 p-4",children:[(0,s.jsx)("div",{className:"jsx-82ef8ed3900938e3 text-xs text-white/60 mb-1",children:"Connected Device"}),(0,s.jsx)("div",{className:"jsx-82ef8ed3900938e3 text-sm font-semibold text-white",children:null!==(r=null!==(t=n.name)&&void 0!==t?t:n.id)&&void 0!==r?r:"Unknown Device"})]}),(0,s.jsx)("button",{onClick:()=>{d&&d(),p(!1)},className:"jsx-82ef8ed3900938e3 w-full py-3 rounded-full bg-[#b34a4a] hover:bg-[#a24141] text-white font-medium transition-colors",children:"Disconnect"})]}):(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 space-y-3",children:[(0,s.jsx)("p",{className:"jsx-82ef8ed3900938e3 text-xs text-white/70",children:"Tap Scan to find nearby Bluetooth devices."}),(0,s.jsx)("button",{onClick:b,disabled:u||!x,className:"jsx-82ef8ed3900938e3 w-full py-3 rounded-full bg-white text-black font-medium hover:bg-white/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Scanning…":"Scan Devices"}),!x&&(0,s.jsx)("p",{className:"jsx-82ef8ed3900938e3 text-xs text-red-400 text-center",children:"Bluetooth is off or unavailable."}),h.length>0&&(0,s.jsxs)("div",{className:"jsx-82ef8ed3900938e3 space-y-2 max-h-48 overflow-y-auto",children:[(0,s.jsx)("div",{className:"jsx-82ef8ed3900938e3 text-xs text-white/60 font-medium",children:"Available Devices"}),h.map(e=>{var t,r;return(0,s.jsxs)("button",{onClick:()=>w(e),className:"jsx-82ef8ed3900938e3 w-full px-4 py-3 rounded-xl bg-white/10 hover:bg-white/20 border border-white/20 text-left transition-colors",children:[(0,s.jsx)("div",{className:"jsx-82ef8ed3900938e3 text-sm font-medium text-white",children:null!==(r=null!==(t=e.name)&&void 0!==t?t:e.id)&&void 0!==r?r:"Unknown Device"}),(0,s.jsx)("div",{className:"jsx-82ef8ed3900938e3 text-xs text-white/60 mt-0.5",children:"Tap to connect"})]},e.id)})]})]})]})}),(0,s.jsx)(i(),{id:"82ef8ed3900938e3",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes shimmer{0%{background-position:-150%center}100%{background-position:150%center}}@-moz-keyframes shimmer{0%{background-position:-150%center}100%{background-position:150%center}}@-o-keyframes shimmer{0%{background-position:-150%center}100%{background-position:150%center}}@keyframes shimmer{0%{background-position:-150%center}100%{background-position:150%center}}"})]})}},2602:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return n},noSSR:function(){return l}});let s=r(8754);r(5893),r(7294);let a=s._(r(5491));function i(e){return{default:(null==e?void 0:e.default)||e}}function l(e,t){return delete t.webpack,delete t.modules,e(t)}function n(e,t){let r=a.default,s={loading:e=>{let{error:t,isLoading:r,pastDelay:s}=e;return null}};e instanceof Promise?s.loader=()=>e:"function"==typeof e?s.loader=e:"object"==typeof e&&(s={...s,...e});let n=(s={...s,...t}).loader;return(s.loadableGenerated&&(s={...s,...s.loadableGenerated},delete s.loadableGenerated),"boolean"!=typeof s.ssr||s.ssr)?r({...s,loader:()=>null!=n?n().then(i):Promise.resolve(i(()=>null))}):(delete s.webpack,delete s.modules,l(r,s))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1159:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return s}});let s=r(8754)._(r(7294)).default.createContext(null)},5491:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return h}});let s=r(8754)._(r(7294)),a=r(1159),i=[],l=[],n=!1;function o(e){let t=e(),r={loading:!0,loaded:null,error:null};return r.promise=t.then(e=>(r.loading=!1,r.loaded=e,e)).catch(e=>{throw r.loading=!1,r.error=e,e}),r}class c{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function d(e){return function(e,t){let r=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),i=null;function o(){if(!i){let t=new c(e,r);i={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return i.promise()}if(!n){let e=r.webpack?r.webpack():r.modules;e&&l.push(t=>{for(let r of e)if(t.includes(r))return o()})}function d(e,t){!function(){o();let e=s.default.useContext(a.LoadableContext);e&&Array.isArray(r.modules)&&r.modules.forEach(t=>{e(t)})}();let l=s.default.useSyncExternalStore(i.subscribe,i.getCurrentValue,i.getCurrentValue);return s.default.useImperativeHandle(t,()=>({retry:i.retry}),[]),s.default.useMemo(()=>{var t;return l.loading||l.error?s.default.createElement(r.loading,{isLoading:l.loading,pastDelay:l.pastDelay,timedOut:l.timedOut,error:l.error,retry:i.retry}):l.loaded?s.default.createElement((t=l.loaded)&&t.default?t.default:t,e):null},[e,l])}return d.preload=()=>o(),d.displayName="LoadableComponent",s.default.forwardRef(d)}(o,e)}function u(e,t){let r=[];for(;e.length;){let s=e.pop();r.push(s(t))}return Promise.all(r).then(()=>{if(e.length)return u(e,t)})}d.preloadAll=()=>new Promise((e,t)=>{u(i).then(e,t)}),d.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let r=()=>(n=!0,t());u(l,e).then(r,r)})),window.__NEXT_PRELOADREADY=d.preloadReady;let h=d},5267:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(5893),a=r(9008),i=r.n(a),l=r(1163),n=r(7294),o=r(5152);function c(e){let{timeData:t,rawData:a,filteredData:i,thresholdHigh:l,thresholdLow:o}=e,c=(0,n.useRef)(null),d=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(c.current)return Promise.all([r.e(196),r.e(78)]).then(r.bind(r,9085)).then(e=>{let{Chart:r}=e,s=c.current.getContext("2d");d.current&&d.current.destroy(),d.current=new r(s,{type:"line",data:{labels:t,datasets:[{label:"Raw Acceleration",data:a,borderColor:"rgba(255, 99, 132, 0.5)",backgroundColor:"rgba(255, 99, 132, 0.1)",borderWidth:2,pointRadius:0,tension:.1},{label:"Filtered (Kalman)",data:i,borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.1)",borderWidth:2,pointRadius:0,tension:.1},{label:"High Threshold",data:Array(t.length).fill(l),borderColor:"rgba(75, 192, 192, 0.5)",borderWidth:1,borderDash:[5,5],pointRadius:0,fill:!1},{label:"Low Threshold",data:Array(t.length).fill(o),borderColor:"rgba(255, 159, 64, 0.5)",borderWidth:1,borderDash:[5,5],pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},scales:{x:{display:!0,title:{display:!0,text:"Time (seconds)",color:"rgba(255, 255, 255, 0.7)"},ticks:{color:"rgba(255, 255, 255, 0.5)",maxRotation:0,autoSkipPadding:20},grid:{color:"rgba(255, 255, 255, 0.1)"}},y:{display:!0,title:{display:!0,text:"Acceleration (m/s\xb2)",color:"rgba(255, 255, 255, 0.7)"},ticks:{color:"rgba(255, 255, 255, 0.5)"},grid:{color:"rgba(255, 255, 255, 0.1)"},min:8,max:12}},plugins:{legend:{display:!0,position:"top",labels:{color:"rgba(255, 255, 255, 0.7)",font:{size:11},padding:10,usePointStyle:!0}},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"rgba(255, 255, 255, 0.9)",bodyColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1}}}})}),()=>{d.current&&d.current.destroy()}},[t,a,i,l,o]),(0,s.jsx)("div",{className:"w-full h-64 md:h-80",children:(0,s.jsx)("canvas",{ref:c})})}function d(e){let{notification:t,onDismiss:r}=e,[a,i]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{if(t){i(!0);let e=setTimeout(()=>{i(!1),r&&setTimeout(r,300)},t.duration||3e3);return()=>clearTimeout(e)}},[t,r]),!t)return null;let l={rep:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",nfc:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",success:"linear-gradient(135deg, #10b981 0%, #059669 100%)",error:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",info:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)"},o={rep:"\uD83C\uDFAF",nfc:"\uD83D\uDCF1",success:"✅",error:"❌",info:"ℹ️"};return(0,s.jsx)("div",{className:"fixed top-20 right-4 z-50 px-6 py-3 rounded-lg text-white font-bold text-lg shadow-lg transform transition-all duration-300 ".concat(a?"translate-x-0 opacity-100":"translate-x-full opacity-0"),style:{background:l[t.type]||l.info},children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:o[t.type]||o.info}),(0,s.jsx)("span",{children:t.message})]})})}r.n(o)()(()=>Promise.all([r.e(196),r.e(78)]).then(r.bind(r,9085)).then(e=>e.Chart),{loadableGenerated:{webpack:()=>[null]},ssr:!1});var u=r(2492),h=r(7333);class x{addSample(e,t,r,s,a,i,l,n,o,c,d){let u={timestamp:d,accelX:e,accelY:t,accelZ:r,gyroX:s,gyroY:a,gyroZ:i,roll:l,pitch:n,yaw:o,accelMag:c,repNumber:Math.max(1,this.repCount+1)};this.allSamples.push(u),this.accelBuffer.push(c),this.timeBuffer.push(d),this.accelBuffer.length>=this.windowSamples&&this.processWindow()}processWindow(){let e=this.accelBuffer.slice(-this.windowSamples),t=this.timeBuffer.slice(-this.windowSamples),r=Math.max(...e),s=Math.min(...e),a=e.reduce((e,t)=>e+t,0)/e.length,i=r-s,l=Math.min(Math.max(.2*i,.2),Math.max(.6*Math.sqrt(e.reduce((e,t)=>e+Math.pow(t-a,2),0)/e.length),.2));this.thresholdHigh=a+l,this.thresholdLow=a-l,this.repHeight=i,this.detectRepsInWindow(e,t)}detectRepsInWindow(e,t){let r=e.length,s=this.accelBuffer.length-1,a=[];for(let i=3;i<r-3;i++){let l=!0,n=e[i];for(let t=i-3;t<=i+3;t++)if(t!==i&&e[t]>=n){l=!1;break}if(l&&n>this.thresholdHigh){let e=s-(r-1-i);(-1===this.lastPeakIndex||e-this.lastPeakIndex>=this.minPeakDistance)&&a.push({index:e,value:n,time:t[i]})}}let i=[];for(let a=3;a<r-3;a++){let l=!0,n=e[a];for(let t=a-3;t<=a+3;t++)if(t!==a&&e[t]<=n){l=!1;break}if(l&&n<this.thresholdLow){let e=s-(r-1-a);(-1===this.lastValleyIndex||e-this.lastValleyIndex>=this.minPeakDistance)&&i.push({index:e,value:n,time:t[a]})}}if(i.length>=1&&a.length>=1){let e,t,r,s;let l=i[i.length-1],n=a[a.length-1],o=!1;if(l.index<n.index){if(n.index<=this.lastDetectedPeakIndex)return;e=l,t=n,r=Math.abs(n.value-l.value),s=(n.time-l.time)/1e3,o=!0}else if(n.index<l.index){if(l.index<=this.lastDetectedValleyIndex)return;e=n,t=l,r=Math.abs(n.value-l.value),s=(l.time-n.time)/1e3,o=!0}o&&s>=this.minRepDuration&&s<=this.maxRepDuration&&r>=this.minPeakProminence&&(this.completeRep(e,n,t),this.lastDetectedValleyIndex=l.index,this.lastDetectedPeakIndex=n.index,this.lastValleyIndex=l.index,this.lastPeakIndex=n.index,this.lastRepEndTime=t.time)}i.length>0&&0===a.length?(this.inRepPhase=!0,this.state="STARTING"):a.length>0?this.state="LIFTING":(this.inRepPhase=!1,this.state="REST")}completeRep(e,t,r){this.repCount++;let s=(r.time-e.time)/1e3;this.reps.push({repNumber:this.repCount,startTime:e.time,endTime:r.time,duration:s,peakValue:t.value,valleyValue:e.value,range:Math.abs(t.value-e.value)}),this.repTimes.push(s);for(let e=this.allSamples.length-1;e>=0;e--){let t=this.allSamples[e];if(t.repNumber===this.repCount)t.repNumber=this.repCount;else break}}getAverageRepTime(){return 0===this.repTimes.length?0:this.repTimes.reduce((e,t)=>e+t,0)/this.repTimes.length}getLastRepTime(){return this.repTimes.length>0?this.repTimes[this.repTimes.length-1]:0}getStats(){return{repCount:this.repCount,averageRepTime:this.getAverageRepTime(),lastRepTime:this.getLastRepTime(),state:this.state,thresholdHigh:this.thresholdHigh,thresholdLow:this.thresholdLow,repHeight:this.repHeight,bufferSize:this.accelBuffer.length,windowSize:this.windowSamples}}reset(){this.repCount=0,this.accelBuffer=[],this.timeBuffer=[],this.allSamples=[],this.reps=[],this.currentRep=null,this.lastRepEndTime=0,this.repTimes=[],this.state="IDLE",this.lastPeakIndex=-1,this.lastValleyIndex=-1,this.lastDetectedValleyIndex=-1,this.lastDetectedPeakIndex=-1,this.inRepPhase=!1,this.repStartTime=0}exportData(){return{samples:this.allSamples,reps:this.reps,stats:this.getStats()}}constructor(e={}){this.repCount=0,this.windowDuration=e.windowDuration||1.5,this.windowOverlap=e.windowOverlap||.8,this.samplingRate=e.samplingRate||20,this.windowSamples=Math.floor(this.windowDuration*this.samplingRate),this.stepSize=Math.floor(this.windowSamples*(1-this.windowOverlap)),this.accelBuffer=[],this.timeBuffer=[],this.allSamples=[],this.reps=[],this.currentRep=null,this.lastRepEndTime=0,this.minPeakProminence=e.minPeakProminence||.15,this.minPeakDistance=e.minPeakDistance||15,this.minRepDuration=e.minRepDuration||0,this.maxRepDuration=e.maxRepDuration||12,this.thresholdHigh=10.5,this.thresholdLow=9.5,this.repHeight=0,this.state="IDLE",this.lastPeakIndex=-1,this.lastValleyIndex=-1,this.lastDetectedValleyIndex=-1,this.lastDetectedPeakIndex=-1,this.inRepPhase=!1,this.repTimes=[],this.repStartTime=0}}class m{update(e){this.estimationError+=this.processNoise;let t=this.estimationError/(this.estimationError+this.measurementNoise);return this.value+=t*(e-this.value),this.estimationError=(1-t)*this.estimationError,this.value}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.value=e,this.estimationError=1}constructor(e=.01,t=.5,r=1,s=0){this.processNoise=e,this.measurementNoise=t,this.estimationError=r,this.value=s}}function f(){let e=(0,l.useRouter)(),{equipment:t,workout:r}=e.query,{connected:a,device:o,scanning:f,devicesFound:p,availability:g,scanDevices:b,connectToDevice:w,disconnect:j}=(0,h.E)(),[y,v]=(0,n.useState)(!1),[k,N]=(0,n.useState)(!1),[S,C]=(0,n.useState)(!1),[_,D]=(0,n.useState)(3),[R,L]=(0,n.useState)(!1),P=(0,n.useRef)(0),M=(0,n.useRef)([]),[E,F]=(0,n.useState)(!1),[T,I]=(0,n.useState)(30),z=(0,n.useRef)(null),[B,V]=(0,n.useState)(!1),[A,O]=(0,n.useState)(0),H=(0,n.useRef)(null),W=(0,n.useRef)(new x),[X,Y]=(0,n.useState)(W.current.getStats()),[Z,U]=(0,n.useState)(null),[G,q]=(0,n.useState)(1),[K,J]=(0,n.useState)(2),[Q,$]=(0,n.useState)(5),[ee,et]=(0,n.useState)([]),[er,es]=(0,n.useState)([]),[ea,ei]=(0,n.useState)([]),[el,en]=(0,n.useState)({accelX:0,accelY:0,accelZ:0,gyroX:0,gyroY:0,gyroZ:0,roll:0,pitch:0,yaw:0,rawMagnitude:0,filteredMagnitude:0}),[eo,ec]=(0,n.useState)(0),[ed,eu]=(0,n.useState)(0),eh=(0,n.useRef)(Date.now()),ex=(0,n.useRef)(0),{isSubscribed:em,error:ef,resetFilters:ep}=function(e,t){let{device:r,connected:s}=(0,h.E)(),[a,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(null),c=(0,n.useRef)(null),d=(0,n.useRef)(null),u=(0,n.useRef)({x:new m(.01,.5,1,0),y:new m(.01,.5,1,0),z:new m(.01,.5,1,9.81)}),x=(0,n.useCallback)(t=>{try{let r=t.target.value,s=new DataView(r.buffer),a={accelX:s.getFloat32(0,!0),accelY:s.getFloat32(4,!0),accelZ:s.getFloat32(8,!0),gyroX:s.getFloat32(12,!0),gyroY:s.getFloat32(16,!0),gyroZ:s.getFloat32(20,!0),roll:s.getFloat32(24,!0),pitch:s.getFloat32(28,!0),yaw:s.getFloat32(32,!0),timestamp:s.getUint32(36,!0)},i=Math.sqrt(a.accelX*a.accelX+a.accelY*a.accelY+a.accelZ*a.accelZ),l=u.current,n=l.x.update(a.accelX),o=l.y.update(a.accelY),c=l.z.update(a.accelZ);e&&e({...a,rawMagnitude:i,filteredX:n,filteredY:o,filteredZ:c,filteredMagnitude:Math.sqrt(n*n+o*o+c*c)})}catch(e){console.error("Error parsing IMU data:",e),o(e.message)}},[e]),f=(0,n.useCallback)(e=>{try{let t=e.target.value,r=new DataView(t.buffer),s=r.getUint8(0);for(let e=1;e<=s&&e<t.byteLength;e++)String.fromCharCode(r.getUint8(e))}catch(e){console.error("Error parsing NFC data:",e),o(e.message)}},[null]);return(0,n.useEffect)(()=>{if(!r||!s||!r.gatt){i(!1);return}let e=!0;return async function(){try{o(null);let t=r.gatt;t.connected||await t.connect();let s=await t.getPrimaryService("4fafc201-1fb5-459e-8fcc-c5c9c331914b"),a=await s.getCharacteristic("beb5483e-36e1-4688-b7f5-ea07361b26a8");await a.startNotifications(),a.addEventListener("characteristicvaluechanged",x),c.current=a;try{let e=await s.getCharacteristic("ceb5483e-36e1-4688-b7f5-ea07361b26a8");await e.startNotifications(),e.addEventListener("characteristicvaluechanged",f),d.current=e}catch(e){console.warn("NFC characteristic not available:",e)}e&&i(!0)}catch(t){console.error("Failed to subscribe to characteristics:",t),e&&(o(t.message),i(!1))}}(),()=>{if(e=!1,c.current){try{c.current.removeEventListener("characteristicvaluechanged",x),c.current.stopNotifications()}catch(e){console.error("Error cleaning up IMU characteristic:",e)}c.current=null}if(d.current){try{d.current.removeEventListener("characteristicvaluechanged",f),d.current.stopNotifications()}catch(e){console.error("Error cleaning up NFC characteristic:",e)}d.current=null}}},[r,s,x,f]),{isSubscribed:a,error:l,resetFilters:(0,n.useCallback)(()=>{u.current.x.reset(0),u.current.y.reset(0),u.current.z.reset(9.81)},[])}}((0,n.useCallback)(e=>{en(e),ex.current++;let t=Date.now();if(t-eh.current>=1e3&&(eu(ex.current),ec(e=>e+ex.current),ex.current=0,eh.current=t),y&&!k){0===P.current&&(P.current=e.timestamp);let t=e.timestamp-P.current;M.current.push({timestamp:t,...e});let r=Math.floor(t/1e3),s=t%1e3,a="".concat(r,".").concat(s.toString().padStart(3,"0"));et(e=>{let t=[...e,a];return t.length>100?t.slice(-100):t}),es(t=>{let r=[...t,e.rawMagnitude];return r.length>100?r.slice(-100):r}),ei(t=>{let r=[...t,e.filteredMagnitude];return r.length>100?r.slice(-100):r}),R||(W.current.addSample(e.accelX,e.accelY,e.accelZ,e.gyroX,e.gyroY,e.gyroZ,e.roll,e.pitch,e.yaw,e.filteredMagnitude,t),Y(W.current.getStats()))}},[y,k,R]),0);(0,n.useEffect)(()=>(!y||k||R?H.current&&(clearInterval(H.current),H.current=null):H.current=setInterval(()=>{O(e=>e+1)},1e3),()=>{H.current&&clearInterval(H.current)}),[y,k,R]);let eg=()=>{N(e=>!e)},eb=()=>{F(!0),N(!0),I(30)},ew=()=>{F(!1),N(!1),v(!1),W.current.reset(),Y(W.current.getStats()),q(e=>e+1),et([]),es([]),ei([]),P.current=0};(0,n.useEffect)(()=>{y&&!k&&!R&&!E&&X.repCount>=Q&&X.repCount>0&&(G>=K?(v(!1),N(!1),V(!0)):eb())},[X.repCount,Q,y,k,R,E,G,K]),(0,n.useEffect)(()=>(E?z.current=setInterval(()=>{I(e=>e<=1?(ew(),30):e-1)},1e3):z.current&&(clearInterval(z.current),z.current=null),()=>{z.current&&clearInterval(z.current)}),[E]);let ej=async()=>{if(!a||!em){alert("Please connect to your IMU device first!");return}v(!0),L(!0),N(!1),P.current=0,M.current=[],W.current.reset(),ep(),Y(W.current.getStats()),et([]),es([]),ei([]),ec(0),O(0),q(1),C(!0),D(3);for(let e=3;e>0;e--)D(e),await new Promise(e=>setTimeout(e,1e3));D("GO!"),await new Promise(e=>setTimeout(e,500)),L(!1),C(!1),L(!1)},ey=()=>{v(!1),N(!1),F(!1),M.current.length>0&&confirm("Recorded ".concat(X.repCount," reps with ").concat(M.current.length," samples. Download CSV?"))&&ev(),q(1),W.current.reset(),Y(W.current.getStats())},ev=()=>{let e=W.current.exportData().samples;if(0===e.length){alert("No data to export!");return}let t="rep,timestamp,timestamp_ms,accelX,accelY,accelZ,accelMag,gyroX,gyroY,gyroZ,roll,pitch,yaw,filteredX,filteredY,filteredZ,filteredMag\n";e.forEach(e=>{let r=Math.floor(e.timestamp/1e3),s=e.timestamp%1e3,a="".concat(r.toString().padStart(2,"0"),".").concat(s.toString().padStart(3,"0")),i=[e.repNumber,a,e.timestamp,e.accelX.toFixed(4),e.accelY.toFixed(4),e.accelZ.toFixed(4),e.accelMag.toFixed(4),e.gyroX.toFixed(4),e.gyroY.toFixed(4),e.gyroZ.toFixed(4),e.roll.toFixed(2),e.pitch.toFixed(2),e.yaw.toFixed(2),e.accelX.toFixed(4),e.accelY.toFixed(4),e.accelZ.toFixed(4),e.accelMag.toFixed(4)];t+=i.join(",")+"\n"});let s=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download="applift_".concat(r,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a)},ek=e=>"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"));return(0,s.jsxs)("div",{className:"relative min-h-screen bg-black text-white",children:[(0,s.jsx)(i(),{children:(0,s.jsxs)("title",{children:["Workout Monitor — ",r," — AppLift"]})}),S&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:(0,s.jsx)("div",{className:"text-9xl font-bold text-white animate-pulse",children:_})}),E&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-8",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-white text-center",children:"Current set done!"}),(0,s.jsx)("div",{className:"text-xl font-semibold text-white/80 text-center",children:"Take a break"}),(0,s.jsxs)("div",{className:"relative w-64 h-64",children:[(0,s.jsxs)("svg",{className:"w-full h-full transform -rotate-90",children:[(0,s.jsx)("circle",{cx:"128",cy:"128",r:"110",stroke:"rgba(255, 255, 255, 0.1)",strokeWidth:"12",fill:"none"}),(0,s.jsx)("circle",{cx:"128",cy:"128",r:"110",stroke:"url(#gradient)",strokeWidth:"12",fill:"none",strokeLinecap:"round",strokeDasharray:"".concat(2*Math.PI*110),strokeDashoffset:"".concat(2*Math.PI*110*(1-(30-T)/30)),style:{transition:"stroke-dashoffset 1s linear"}}),(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"#c084fc"}),(0,s.jsx)("stop",{offset:"100%",stopColor:"#9333ea"})]})})]}),(0,s.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,s.jsx)("div",{className:"text-7xl font-bold text-white",children:T}),(0,s.jsx)("div",{className:"text-xl text-white/60 mt-1",children:"seconds"})]})]}),(0,s.jsx)("button",{onClick:()=>{z.current&&(clearInterval(z.current),z.current=null),I(30),ew()},className:"px-8 py-4 rounded-full font-bold text-white text-xl transition-all hover:scale-105",style:{background:"linear-gradient(to bottom right, #c084fc 0%, #9333ea 100%)",boxShadow:"0 4px 12px rgba(147, 51, 234, 0.3)"},children:"Skip Break"})]})}),B&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 px-4",children:(0,s.jsxs)("div",{className:"rounded-3xl p-8 max-w-md w-full text-center",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)"},children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDF89"}),(0,s.jsx)("h2",{className:"text-4xl font-bold text-white mb-4",children:"Congratulations!"}),(0,s.jsxs)("p",{className:"text-xl text-white/80 mb-6",children:["You completed ",K," sets of ",Q," reps!"]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>{V(!1),M.current.length>0&&confirm("Download workout data CSV?")&&ev(),e.back()},className:"flex-1 px-6 py-3 rounded-full font-bold text-white text-lg transition-all",style:{background:"linear-gradient(to bottom right, #c084fc 0%, #9333ea 100%)",boxShadow:"0 4px 12px rgba(147, 51, 234, 0.3)"},children:"Finish"}),(0,s.jsx)("button",{onClick:()=>{V(!1),q(1),W.current.reset(),Y(W.current.getStats()),et([]),es([]),ei([]),P.current=0,M.current=[],O(0)},className:"flex-1 px-6 py-3 rounded-full font-bold text-white text-lg transition-all border-2 border-white/30 hover:border-white/50",children:"Do Another"})]})]})}),(0,s.jsx)(d,{notification:Z,onDismiss:()=>U(null)}),(0,s.jsxs)("main",{className:"mx-auto w-full max-w-[1200px] px-4 pt-6 pb-24 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("button",{onClick:()=>e.back(),className:"flex items-center justify-center h-10 w-10 rounded-lg bg-white/10 hover:bg-white/20 transition-all","aria-label":"Go back",children:(0,s.jsx)("img",{src:"/images/icons/arrow-point-to-left.png",alt:"Back",className:"w-5 h-5 filter brightness-0 invert"})}),(0,s.jsx)(u.Z,{connected:a,device:o,onScan:b,onConnect:w,onDisconnect:j,scanning:f,devicesFound:p,availability:g})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:r}),(0,s.jsx)("p",{className:"text-sm text-white/60",children:t})]}),!a&&y&&(0,s.jsx)("div",{className:"rounded-xl bg-red-500/20 border border-red-500/50 p-4 text-center animate-pulse",children:(0,s.jsx)("p",{className:"text-sm text-red-300 font-semibold",children:"⚠️ Device disconnected. Please reconnect to continue session."})}),!a&&!y&&(0,s.jsx)("div",{className:"rounded-xl bg-red-500/20 border border-red-500/50 p-4 text-center",children:(0,s.jsx)("p",{className:"text-sm text-red-300",children:"⚠️ Device not connected. Please connect your IMU device."})}),(0,s.jsxs)("div",{className:"rounded-2xl bg-white/5 p-4 border border-white/10 min-h-[400px] mb-8",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-white mb-3",children:"Real-time Acceleration"}),(0,s.jsx)(c,{timeData:ee,rawData:[],filteredData:ea,thresholdHigh:X.thresholdHigh,thresholdLow:X.thresholdLow})]}),(0,s.jsx)("div",{className:"fixed bottom-0 left-0 right-0 px-4 pb-6 pt-4",style:{background:"linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0.98) 80%, rgba(0,0,0,0) 100%)"},children:(0,s.jsx)("div",{className:"mx-auto w-full max-w-[1200px]",children:(0,s.jsxs)("div",{className:"rounded-3xl overflow-hidden",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)"},children:[(0,s.jsx)("div",{className:"p-4 flex items-center justify-between",children:y?(0,s.jsx)(s.Fragment,{children:k?(0,s.jsxs)("button",{onClick:eg,className:"w-full py-4 rounded-full font-bold text-white text-2xl transition-all flex items-center justify-between px-8",style:{background:"linear-gradient(to bottom right, #c084fc 0%, #9333ea 100%)",boxShadow:"0 4px 12px rgba(147, 51, 234, 0.3)"},children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,s.jsx)("span",{children:ek(A)}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),ey()},className:"w-10 h-10 rounded-full bg-red-500/80 hover:bg-red-500 flex items-center justify-center transition-all",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("rect",{x:"6",y:"6",width:"12",height:"12"})})})]}):(0,s.jsxs)("button",{onClick:eg,className:"w-full py-4 rounded-full font-bold text-white text-2xl transition-all flex items-center justify-center gap-3",style:{background:"linear-gradient(to bottom right, #c084fc 0%, #9333ea 100%)",boxShadow:"0 4px 12px rgba(147, 51, 234, 0.3)"},children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})})}),(0,s.jsx)("span",{children:ek(A)})]})}):(0,s.jsxs)("button",{onClick:ej,disabled:!a||!em,className:"w-full py-4 rounded-full font-bold text-white text-2xl transition-all disabled:opacity-50 flex items-center justify-center gap-3",style:{background:"linear-gradient(to bottom right, #c084fc 0%, #9333ea 100%)",boxShadow:"0 4px 12px rgba(147, 51, 234, 0.3)"},children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,s.jsx)("span",{children:"Start Recording"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 pt-2 pb-4 px-4",children:[(0,s.jsxs)("div",{className:"rounded-2xl p-4 relative",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)"},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("img",{src:"/images/applift-logo/AppLift_Logo_White.png",alt:"AppLift",className:"w-6 h-6"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-white/90",children:"Reps"})]}),(0,s.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,s.jsx)("span",{className:"text-4xl font-bold text-white",children:X.repCount}),(0,s.jsx)("span",{className:"text-2xl font-semibold text-white/60",children:"/"}),(0,s.jsx)("span",{className:"text-2xl font-semibold text-white/60",children:Q})]}),(0,s.jsx)("span",{className:"absolute bottom-3 right-3 text-xs font-semibold px-2 py-1 rounded-full bg-purple-500/30 text-purple-200",children:X.state.toLowerCase()})]}),(0,s.jsxs)("div",{className:"rounded-2xl p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)"},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCCA"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-white/90",children:"Set"})]}),(0,s.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,s.jsx)("span",{className:"text-4xl font-bold text-white",children:G}),(0,s.jsx)("span",{className:"text-2xl font-semibold text-white/60",children:"/"}),(0,s.jsx)("span",{className:"text-2xl font-semibold text-white/60",children:K})]})]})]})]})})})]})]})}},5152:function(e,t,r){e.exports=r(2602)}},function(e){e.O(0,[742,888,774,179],function(){return e(e.s=1252)}),_N_E=e.O()}]);